#!/bin/bash

# CyberHawk Setup Fix Script
echo "ğŸ”§ Fixing CyberHawk setup permissions..."

# Check if setup.sh exists
if [ ! -f "setup.sh" ]; then
    echo "âŒ setup.sh not found in current directory!"
    echo "ğŸ“ Current directory: $(pwd)"
    ls -la
    exit 1
fi

# Check current permissions
echo "ğŸ“Š Current permissions:"
ls -la setup.sh

# Make executable
echo "ğŸ” Making setup.sh executable..."
chmod +x setup.sh

# Verify permissions
echo "âœ… New permissions:"
ls -la setup.sh | grep setup.sh

# Check for Windows line endings
if grep -q -U $'\x0D' setup.sh; then
    echo "âš ï¸  Windows line endings detected. Fixing..."
    sudo apt update
    sudo apt install -y dos2unix
    dos2unix setup.sh
    echo "âœ… Line endings fixed"
fi

# Test execution
echo "ğŸš€ Testing script execution..."
if bash -n setup.sh; then
    echo "âœ… Script syntax is valid"
    echo ""
    echo "ğŸ¯ Now run the setup with:"
    echo "   ./setup.sh"
else
    echo "âŒ Script has syntax errors"
    echo "ğŸ“‹ Checking for common issues..."
    # Check first line
    head -1 setup.sh
fi
